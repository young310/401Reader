# KK-1 扣繳申報書解析器

## 簡介

此工具用於解析「扣繳單位稅籍編號扣繳暨免扣繳憑單申報書」（KK-1 表單）的 PDF 文件，並將其轉換為結構化的 JSON 格式。

## 表單說明

KK-1 表單是財政部臺北國稅局用於扣繳憑單申報的表格，主要包含：

- **基本資訊**：扣繳單位統一編號、稅籍編號、名稱、地址、扣繳義務人等
- **所得項目**：各類所得的給付金額和扣繳稅額，分為「個人」和「非個人」兩類
  - 薪資（代號 3）
  - 機關團體補助費（代號 21）
  - 執行機關等獎給（代號 22）
  - 國內利息（代號 4）
  - 租金（代號 51）
  - 權利金（代號 52）
  - 股利或盈餘（代號 11、12）
  - 其他所得（代號 A）
  - 等
- **合計**：總份數、給付總額、扣繳稅額

## 使用方法

### 基本用法

```bash
python parse_kk1.py <PDF檔案路徑> [輸出JSON路徑]
```

### 範例

```bash
# 解析 KK-1.pdf 並輸出到 KK-1.json
python parse_kk1.py KK-1.pdf

# 指定輸出檔案名稱
python parse_kk1.py KK-1.pdf output.json
```

## 輸出格式

解析後的 JSON 格式如下：

```json
{
  "表單類型": "扣繳單位稅籍編號扣繳暨免扣繳憑單申報書",
  "表單編號": "KK-1",
  "基本資訊": {
    "統一編號": "04701378",
    "扣繳單位稅籍編號": "030204357",
    "名稱": "台灣科思創股份有限公司",
    "地址": "台北市信義區信義路五段5號4樓",
    "扣繳義務人": "溫凱查 CARSTEN WILDBERGER",
    "申報期間": "113年01月12日至113年01月12日止"
  },
  "所得項目": [
    {
      "所得類別": "權利金",
      "代號": "52",
      "個人": {
        "起迄號碼": "",
        "給付總額": 0,
        "扣繳稅額": 0,
        "份數": 0
      },
      "非個人": {
        "起迄號碼": "000000001-000000001",
        "給付總額": 17776644,
        "扣繳稅額": 1771664
      }
    }
  ],
  "合計": {
    "份數": 2,
    "給付總額": 18402098,
    "扣繳稅額": 1902755
  }
}
```

## 重要說明

### PDF 格式限制

如果您的 PDF 是**圖像格式**（掃描件），需要使用 OCR 技術來提取文本。請安裝以下依賴：

```bash
# 安裝 OCR 相關套件
pip install pdf2image pytesseract

# macOS 安裝 Tesseract OCR 引擎
brew install tesseract tesseract-lang

# Ubuntu/Debian
sudo apt-get install tesseract-ocr tesseract-ocr-chi-tra

# Windows
# 從 https://github.com/UB-Mannheim/tesseract/wiki 下載安裝
```

### 目前已實現的功能

✅ 基本資訊解析（統一編號、名稱、地址等）
✅ 所得項目解析（權利金、其他所得等）
✅ 合計數據解析
✅ OCR 支援（需額外安裝）

### 範例數據

`KK-1.json` 文件包含了從實際 PDF 中提取的示例數據，可作為參考格式。

主要數據包括：
- **權利金（代號 52）**：
  - 非個人給付總額：17,776,644 元
  - 扣繳稅額：1,771,664 元

- **前2項以外之其他所得（代號 A）**：
  - 非個人給付總額：625,454 元
  - 扣繳稅額：125,091 元

- **合計**：
  - 份數：2
  - 給付總額：18,402,098 元
  - 扣繳稅額：1,902,755 元

## 與 401 表單的差異

| 項目 | 401 表單 | KK-1 表單 |
|------|---------|-----------|
| 用途 | 營業稅申報 | 扣繳憑單申報 |
| 主要內容 | 銷項、進項、稅額計算 | 各類所得、給付金額、扣繳稅額 |
| 分類方式 | 應稅/零稅率銷售額 | 個人/非個人所得 |
| 解析器 | `parse_401.py` | `parse_kk1.py` |

## 技術架構

- **PDF 處理**：pdfplumber（主要）、pdf2image（OCR）
- **OCR 引擎**：pytesseract + Tesseract
- **語言支援**：繁體中文
- **輸出格式**：JSON（UTF-8 編碼）

## 故障排除

### 問題：PDF 無法提取文本

**原因**：PDF 可能是圖像格式
**解決方案**：安裝 OCR 依賴（見上方說明）

### 問題：OCR 辨識率低

**原因**：PDF 解析度不足或圖像品質差
**解決方案**：
1. 使用更高解析度的 PDF
2. 調整 OCR 參數
3. 手動校對 JSON 輸出

### 問題：某些欄位無法解析

**原因**：表單格式變化或特殊情況
**解決方案**：檢查 JSON 輸出，手動補充缺失欄位

## 授權

此工具僅供學習和研究使用，請遵守相關法律法規。

## 更新日誌

- **2024-12-19**：初始版本，支援基本解析功能和 OCR
